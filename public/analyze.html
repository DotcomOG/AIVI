<!DOCTYPE html>
<!--
  analyze.html - v2026.02.06-5
  Two pricing tiers side by side, fixed sessionStorage keys
-->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AIsubtext - AI Visibility Analysis</title>
  <style>
    :root{
      --max-width:900px;
      --primary:#3182CE;
      --muted:#666;
      --border:#e5e5e5;
      --bg-soft:#f7fafc;
    }
    *{box-sizing:border-box}
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;
      background:#fff;
      color:#000;
      margin:0;
      padding:2rem;
      max-width:var(--max-width);
      margin-inline:auto;
    }
    h1{font-size:2.5rem;font-weight:700;margin:0 0 .25rem}
    h1 .ai{color:#0b1220}
    h1 .subtext{color:var(--primary)}
    h1 .tm{font-size:.9rem;vertical-align:super;color:#888}
    h2{font-size:1.2rem;font-weight:600;margin:0 0 1.5rem;color:var(--muted)}
    
    .info-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:2rem;
      padding-bottom:1rem;
      border-bottom:1px solid var(--border);
      flex-wrap:wrap;
      gap:.5rem;
    }
    .powered-by{color:var(--muted);font-size:.9rem}
    .powered-by a{color:var(--primary);text-decoration:none;font-weight:600}
    .for-url{color:var(--muted);font-size:.9rem}
    .for-url strong{color:#000}

    /* Pricing Section */
    .pricing-section h3{
      text-align:center;
      font-size:1.6rem;
      margin:0 0 .5rem;
    }
    .pricing-section .subtitle{
      text-align:center;
      color:var(--muted);
      margin-bottom:1.5rem;
    }

    .pricing-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:1.5rem;
      margin-bottom:2rem;
    }

    .pricing-card{
      border:2px solid var(--border);
      border-radius:12px;
      padding:1.5rem;
      background:#fff;
      display:flex;
      flex-direction:column;
    }
    .pricing-card.featured{
      border-color:var(--primary);
      box-shadow:0 4px 20px rgba(49,130,206,.12);
    }

    .tier-label{
      font-size:.8rem;
      font-weight:700;
      color:var(--primary);
      text-transform:uppercase;
      letter-spacing:.5px;
      margin-bottom:.25rem;
    }
    .tier-name{
      font-size:1.3rem;
      font-weight:800;
      margin-bottom:.5rem;
    }
    .tier-price{
      font-size:2rem;
      font-weight:800;
      margin-bottom:.25rem;
    }
    .tier-desc{
      font-size:.9rem;
      color:var(--muted);
      margin-bottom:1rem;
      line-height:1.5;
    }
    .tier-features{
      list-style:none;
      margin:0 0 1.25rem;
      padding:0;
      flex:1;
    }
    .tier-features li{
      padding:.35rem 0;
      font-size:.9rem;
      color:#333;
      display:flex;
      align-items:flex-start;
      gap:.5rem;
    }
    .tier-features li::before{
      content:'✓';
      color:#16a34a;
      font-weight:700;
    }
    .tier-features li.highlight{
      font-weight:600;
      color:var(--primary);
    }
    .tier-features li.highlight::before{
      content:'★';
      color:var(--primary);
    }

    .form-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:.5rem;
      margin-bottom:.75rem;
    }
    .form-full{grid-column:1/-1}
    .pricing-card input{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:6px;
      font-size:14px;
      font-family:inherit;
    }
    .pricing-card input:focus{outline:none;border-color:var(--primary)}

    .btn-stripe{
      background:#635bff;
      color:#fff;
      border:none;
      padding:.9rem 1.5rem;
      border-radius:8px;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      width:100%;
    }
    .btn-stripe:hover{background:#4b44cc}
    .btn-stripe:disabled{background:#999;cursor:not-allowed}

    .btn-outline{
      background:#fff;
      color:#111;
      border:2px solid #111;
      padding:.85rem 1.5rem;
      border-radius:8px;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      width:100%;
      text-decoration:none;
      text-align:center;
      display:block;
    }
    .btn-outline:hover{background:#f5f5f5}

    .error-msg{
      color:#c00;
      font-size:.85rem;
      margin-top:.5rem;
      display:none;
    }
    .error-msg.show{display:block}

    /* Access Code */
    .access-section{
      background:var(--bg-soft);
      border:1px solid var(--border);
      border-radius:12px;
      padding:1.25rem;
      margin-bottom:2rem;
    }
    .access-section h4{margin:0 0 .75rem;font-size:1rem}
    .access-row{
      display:flex;
      gap:.5rem;
      flex-wrap:wrap;
    }
    .access-row input{
      flex:1;
      min-width:100px;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:6px;
      font-size:14px;
    }
    .access-row input:focus{outline:none;border-color:var(--primary)}
    .access-row button{
      padding:10px 20px;
      background:#fff;
      border:2px solid #111;
      border-radius:6px;
      font-weight:700;
      cursor:pointer;
      white-space:nowrap;
    }
    .access-row button:hover{background:#f5f5f5}

    /* Footer */
    footer{
      margin-top:2rem;
      padding-top:1.5rem;
      border-top:1px solid var(--border);
      color:var(--muted);
      font-size:.85rem;
    }
    footer a{color:var(--primary);text-decoration:none}

    @media(max-width:650px){
      .pricing-grid{grid-template-columns:1fr}
      .form-grid{grid-template-columns:1fr}
      .access-row{flex-direction:column}
      .access-row input{width:100%}
      .access-row button{width:100%}
    }
  </style>
</head>
<body>

  <h1><span class="ai">AI</span><span class="subtext">subtext</span><span class="tm">™</span></h1>
  <h2>AI Visibility Analysis</h2>

  <div class="info-row">
    <div class="powered-by">Powered by <a href="https://quontora.com" target="_blank">Quontora</a></div>
    <div class="for-url">Analysis for: <strong id="current-url">—</strong></div>
  </div>

  <!-- Pricing Section -->
  <section class="pricing-section">
    <h3>Unlock Your Full Report</h3>
    <p class="subtitle">Choose the depth of analysis that fits your needs</p>

    <div class="pricing-grid">
      <!-- Entry: $500 -->
      <div class="pricing-card featured">
        <div class="tier-label">Entry</div>
        <div class="tier-name">Diagnostic Report</div>
        <div class="tier-price">$500</div>
        <div class="tier-desc">One-time report with actionable insights</div>
        <ul class="tier-features">
          <li>Multi-engine AI analysis (5 engines)</li>
          <li>Narrative & trust gap breakdown</li>
          <li>Source-level drivers identified</li>
          <li>Executive-ready PDF report</li>
          <li>Instant delivery</li>
        </ul>
        <form id="entry-form" novalidate>
          <div class="form-grid">
            <input type="text" id="entry-name" placeholder="Your Name" required />
            <input type="text" id="entry-company" placeholder="Company" />
            <input type="email" id="entry-email" placeholder="Email" required class="form-full" />
          </div>
          <button type="submit" class="btn-stripe" id="entry-btn">Buy Report — $500</button>
          <div id="entry-error" class="error-msg"></div>
        </form>
      </div>

      <!-- Core: $1,500+ -->
      <div class="pricing-card">
        <div class="tier-label">Core</div>
        <div class="tier-name">Deep Diagnostic</div>
        <div class="tier-price">$1,500<span style="font-size:1.2rem">+</span></div>
        <div class="tier-desc">Comprehensive analysis + strategic guidance</div>
        <ul class="tier-features">
          <li class="highlight">Everything in Entry, plus:</li>
          <li>Deeper narrative analysis</li>
          <li>Priority remediation roadmap</li>
          <li>Optional 30-min strategy call</li>
          <li>Custom scope for complex sites</li>
        </ul>
        <a href="mailto:hello@quontora.com?subject=Deep%20Diagnostic%20Request" id="core-link" class="btn-outline">Request Deep Diagnostic →</a>
      </div>
    </div>
  </section>

  <!-- Access Code Section -->
  <section class="access-section">
    <h4>Have an Access Code?</h4>
    <form id="code-form" class="access-row" novalidate>
      <input type="text" id="code-name" placeholder="Name" required />
      <input type="email" id="code-email" placeholder="Email" required />
      <input type="text" id="code-input" placeholder="Access Code" required />
      <button type="submit">Unlock</button>
    </form>
    <div id="code-error" class="error-msg"></div>
  </section>

  <footer>
    <p>© 2026 AIsubtext by <a href="https://quontora.com" target="_blank">Quontora</a></p>
  </footer>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const targetUrl = urlParams.get("url");
    
    if (targetUrl) {
      document.getElementById("current-url").textContent = targetUrl;
      document.getElementById("core-link").href = 
        "mailto:hello@quontora.com?subject=Deep%20Diagnostic%20Request&body=URL:%20" + encodeURIComponent(targetUrl);
    } else {
      document.getElementById("current-url").textContent = "No URL provided";
    }

    // Valid codes - EZRA is owner master code
    const VALID_CODES = ['ORBIT', 'QUONTORA', 'DEMO2026', 'PARTNER', 'EZRA'];

    // Entry $500 - Stripe
    document.getElementById('entry-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('entry-name').value.trim();
      const email = document.getElementById('entry-email').value.trim();
      const company = document.getElementById('entry-company').value.trim();
      const errorEl = document.getElementById('entry-error');
      const btn = document.getElementById('entry-btn');

      errorEl.classList.remove('show');

      if (!name || !email) {
        errorEl.textContent = 'Please enter your name and email.';
        errorEl.classList.add('show');
        return;
      }
      if (!targetUrl) {
        errorEl.textContent = 'No URL to analyze.';
        errorEl.classList.add('show');
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Connecting...';

      try {
        const res = await fetch('/api/checkout', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url: targetUrl, email, name, company })
        });
        const data = await res.json();
        if (data.url) {
          window.location.href = data.url;
        } else {
          throw new Error(data.error || 'Checkout failed');
        }
      } catch (err) {
        errorEl.textContent = 'Payment error. Please try again.';
        errorEl.classList.add('show');
        btn.disabled = false;
        btn.textContent = 'Buy Report — $500';
      }
    });

    // Access Code - uses sniperank: keys to match full-report.html
    document.getElementById('code-form').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const name = document.getElementById('code-name').value.trim();
      const email = document.getElementById('code-email').value.trim();
      const code = document.getElementById('code-input').value.trim().toUpperCase();
      const errorEl = document.getElementById('code-error');

      errorEl.classList.remove('show');

      if (!name || !email || !code) {
        errorEl.textContent = 'Please fill in all fields.';
        errorEl.classList.add('show');
        return;
      }
      if (!VALID_CODES.includes(code)) {
        errorEl.textContent = 'Invalid access code.';
        errorEl.classList.add('show');
        return;
      }
      if (!targetUrl) {
        errorEl.textContent = 'No URL to analyze.';
        errorEl.classList.add('show');
        return;
      }

      // Store with sniperank: prefix to match full-report.html expectations
      sessionStorage.setItem('sniperank:name', name);
      sessionStorage.setItem('sniperank:email', email);

      window.location.href = 'full-report.html?url=' + encodeURIComponent(targetUrl) + '&code=' + encodeURIComponent(code);
    });
  </script>

</body>
</html>
